<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>ib_insync速查表 | Bear's dream</title><meta name="description" content="ib_insync速查表"><meta name="keywords" content="finance,IB"><meta name="author" content="supersheepbear"><meta name="copyright" content="supersheepbear"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon_1.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="p43hXBn3_dLvbyxUzx0eo5eYmj9OVYOV52pdrhBa2sw"><meta name="baidu-site-verification" content="EXLlfLv2pV"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ib_insync速查表"><meta name="twitter:description" content="ib_insync速查表"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200210210529.png"><meta property="og:type" content="article"><meta property="og:title" content="ib_insync速查表"><meta property="og:url" content="https://yangxiongwiki.com/2020/03/01/finance/vnpy_notes/ib_insync%E9%80%9F%E6%9F%A5%E8%A1%A8/"><meta property="og:site_name" content="Bear's dream"><meta property="og:description" content="ib_insync速查表"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200210210529.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://yangxiongwiki.com/2020/03/01/finance/vnpy_notes/ib_insync%E9%80%9F%E6%9F%A5%E8%A1%A8/"><link rel="next" title="class_instances_to_dataframe" href="https://yangxiongwiki.com/2020/02/16/python/advanced/class_instances_to_dataframe/"><link rel="stylesheet" href="hfttps://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Bear's dream" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Bear's dream</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 音乐照片</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/photos/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 学习计划</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200520153141.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">34</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">34</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">15</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat" aria-hidden="true"></i><span> 音乐照片</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/photos/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 学习计划</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#ib基础"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">ib基础</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#连接ib"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">连接ib</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#合约查询"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">合约查询</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#日志信息级别"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">日志信息级别</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#断开ib"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">断开ib</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#合约细节"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">合约细节</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#合约基础信息"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">合约基础信息</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#合约查看和filter"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">合约查看和filter</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#期权链"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">期权链</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Bar数据"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">Bar数据</span></a></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ib基础"><span class="toc-number">1.</span> <span class="toc-text">ib基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#连接ib"><span class="toc-number">1.1.</span> <span class="toc-text">连接ib</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#合约查询"><span class="toc-number">1.2.</span> <span class="toc-text">合约查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#日志信息级别"><span class="toc-number">1.3.</span> <span class="toc-text">日志信息级别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#断开ib"><span class="toc-number">1.4.</span> <span class="toc-text">断开ib</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#合约细节"><span class="toc-number">2.</span> <span class="toc-text">合约细节</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#合约基础信息"><span class="toc-number">2.1.</span> <span class="toc-text">合约基础信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#合约查看和filter"><span class="toc-number">2.2.</span> <span class="toc-text">合约查看和filter</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#期权链"><span class="toc-number">3.</span> <span class="toc-text">期权链</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Bar数据"><span class="toc-number">4.</span> <span class="toc-text">Bar数据</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200210210529.png)"><div id="post-info"><div id="post-title"><div class="posttitle">ib_insync速查表</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-03-01<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-03-01</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/finance/">finance</a><i class="fa fa-angle-right fa-fw" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/finance/vnpy-notes/">vnpy_notes</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2020/03/01/finance/vnpy_notes/ib_insync%E9%80%9F%E6%9F%A5%E8%A1%A8/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/03/01/finance/vnpy_notes/ib_insync%E9%80%9F%E6%9F%A5%E8%A1%A8/" itemprop="commentCount"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>此文为ib_insync需要下载历史数据用的一些操作. 目的是能迅速查到想要的code.<br>ib_insync是ib的 python api. 因为vnpy已经封装了ib的实盘模块, 所以我用ib_insync只是为了下载历史数据.</p>
<h1 id="ib基础"><a href="#ib基础" class="headerlink" title="ib基础"></a>ib基础</h1><h2 id="连接ib"><a href="#连接ib" class="headerlink" title="连接ib"></a>连接ib</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ib_insync</span><br><span class="line">print(ib_insync.__all__)</span><br></pre></td></tr></table></figure></div>
<pre><code>[&#39;util&#39;, &#39;Event&#39;, &#39;SoftDollarTier&#39;, &#39;PriceIncrement&#39;, &#39;Execution&#39;, &#39;CommissionReport&#39;, &#39;BarList&#39;, &#39;BarDataList&#39;, &#39;RealTimeBarList&#39;, &#39;BarData&#39;, &#39;RealTimeBar&#39;, &#39;HistogramData&#39;, &#39;NewsProvider&#39;, &#39;DepthMktDataDescription&#39;, &#39;ScannerSubscription&#39;, &#39;ScanDataList&#39;, &#39;FundamentalRatios&#39;, &#39;ExecutionFilter&#39;, &#39;PnL&#39;, &#39;PnLSingle&#39;, &#39;AccountValue&#39;, &#39;TickData&#39;, &#39;TickByTickAllLast&#39;, &#39;TickByTickBidAsk&#39;, &#39;TickByTickMidPoint&#39;, &#39;HistoricalTick&#39;, &#39;HistoricalTickBidAsk&#39;, &#39;HistoricalTickLast&#39;, &#39;TickAttrib&#39;, &#39;TickAttribBidAsk&#39;, &#39;TickAttribLast&#39;, &#39;MktDepthData&#39;, &#39;DOMLevel&#39;, &#39;TradeLogEntry&#39;, &#39;TagValue&#39;, &#39;FamilyCode&#39;, &#39;SmartComponent&#39;, &#39;PortfolioItem&#39;, &#39;Position&#39;, &#39;Fill&#39;, &#39;OptionComputation&#39;, &#39;OptionChain&#39;, &#39;Dividends&#39;, &#39;NewsArticle&#39;, &#39;HistoricalNews&#39;, &#39;NewsTick&#39;, &#39;NewsBulletin&#39;, &#39;ConnectionStats&#39;, &#39;Contract&#39;, &#39;Stock&#39;, &#39;Option&#39;, &#39;Future&#39;, &#39;ContFuture&#39;, &#39;Forex&#39;, &#39;Index&#39;, &#39;CFD&#39;, &#39;Commodity&#39;, &#39;Bond&#39;, &#39;FuturesOption&#39;, &#39;MutualFund&#39;, &#39;Warrant&#39;, &#39;Bag&#39;, &#39;ComboLeg&#39;, &#39;DeltaNeutralContract&#39;, &#39;ContractDetails&#39;, &#39;ContractDescription&#39;, &#39;ScanData&#39;, &#39;Trade&#39;, &#39;Order&#39;, &#39;OrderStatus&#39;, &#39;OrderState&#39;, &#39;OrderComboLeg&#39;, &#39;LimitOrder&#39;, &#39;MarketOrder&#39;, &#39;StopOrder&#39;, &#39;StopLimitOrder&#39;, &#39;BracketOrder&#39;, &#39;OrderCondition&#39;, &#39;ExecutionCondition&#39;, &#39;MarginCondition&#39;, &#39;TimeCondition&#39;, &#39;PriceCondition&#39;, &#39;PercentChangeCondition&#39;, &#39;VolumeCondition&#39;, &#39;Ticker&#39;, &#39;IB&#39;, &#39;Client&#39;, &#39;Wrapper&#39;, &#39;FlexReport&#39;, &#39;FlexError&#39;, &#39;IBC&#39;, &#39;IBController&#39;, &#39;Watchdog&#39;]
</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ib_insync <span class="keyword">import</span> *</span><br><span class="line">util.startLoop()</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ib = IB()</span><br><span class="line">ib.connect(<span class="string">'127.0.0.1'</span>, <span class="number">7497</span>, clientId=<span class="number">37</span>)</span><br></pre></td></tr></table></figure></div>
<pre><code>&lt;IB connected to 127.0.0.1:7497 clientId=37&gt;
</code></pre><h2 id="合约查询"><a href="#合约查询" class="headerlink" title="合约查询"></a>合约查询</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ib.reqPositions()</span><br></pre></td></tr></table></figure></div>
<pre><code>[Position(account=&#39;DU1331072&#39;, contract=Forex(&#39;EURUSD&#39;, conId=12087792, localSymbol=&#39;EUR.USD&#39;, tradingClass=&#39;EUR.USD&#39;), position=0.0, avgCost=0.0)]
</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ib.positions()</span><br></pre></td></tr></table></figure></div>
<pre><code>[]
</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[v <span class="keyword">for</span> v <span class="keyword">in</span> ib.accountValues() <span class="keyword">if</span> v.tag == <span class="string">'NetLiquidationByCurrency'</span> <span class="keyword">and</span> v.currency == <span class="string">'BASE'</span>]</span><br></pre></td></tr></table></figure></div>
<pre><code>[AccountValue(account=&#39;DU1331072&#39;, tag=&#39;NetLiquidationByCurrency&#39;, value=&#39;1016878.84&#39;, currency=&#39;BASE&#39;, modelCode=&#39;&#39;)]
</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Contract(conId=<span class="number">270639</span>)</span><br><span class="line">Stock(<span class="string">'AMD'</span>, <span class="string">'SMART'</span>, <span class="string">'USD'</span>)</span><br><span class="line">Stock(<span class="string">'INTC'</span>, <span class="string">'SMART'</span>, <span class="string">'USD'</span>, primaryExchange=<span class="string">'NASDAQ'</span>)</span><br><span class="line">Forex(<span class="string">'EURUSD'</span>)</span><br><span class="line">CFD(<span class="string">'IBUS30'</span>)</span><br><span class="line">Future(<span class="string">'ES'</span>, <span class="string">'20180921'</span>, <span class="string">'GLOBEX'</span>)</span><br><span class="line">Option(<span class="string">'SPY'</span>, <span class="string">'20170721'</span>, <span class="number">240</span>, <span class="string">'C'</span>, <span class="string">'SMART'</span>)</span><br><span class="line">Bond(secIdType=<span class="string">'ISIN'</span>, secId=<span class="string">'US03076KAA60'</span>);</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">contract = Stock(<span class="string">'TSLA'</span>, <span class="string">'SMART'</span>, <span class="string">'USD'</span>)</span><br><span class="line">ib.reqContractDetails(contract)</span><br></pre></td></tr></table></figure></div>
<pre><code>[ContractDetails(contract=Contract(secType=&#39;STK&#39;, conId=76792991, symbol=&#39;TSLA&#39;, exchange=&#39;SMART&#39;, primaryExchange=&#39;NASDAQ&#39;, currency=&#39;USD&#39;, localSymbol=&#39;TSLA&#39;, tradingClass=&#39;NMS&#39;), marketName=&#39;NMS&#39;, minTick=0.01, orderTypes=&#39;ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DARKONLY,DARKPOLL,DAY,DEACT,DEACTDIS,DEACTEOD,DIS,GAT,GTC,GTD,GTT,HID,IBKRATS,ICE,IMB,IOC,LIT,LMT,LOC,MIT,MKT,MOC,MTL,NGCOMB,NODARK,NONALGO,OCA,OPG,OPGREROUT,PEGBENCH,POSTONLY,PREOPGRTH,REL,RPI,RTH,SCALE,SCALEODD,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,SWEEP,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF&#39;, validExchanges=&#39;SMART,AMEX,NYSE,CBOE,PHLX,ISE,CHX,ARCA,ISLAND,DRCTEDGE,BEX,BATS,EDGEA,CSFBALGO,JEFFALGO,BYX,IEX,EDGX,FOXRIVER,NYSENAT,PSX&#39;, priceMagnifier=1, underConId=0, longName=&#39;TESLA INC&#39;, contractMonth=&#39;&#39;, industry=&#39;Consumer, Cyclical&#39;, category=&#39;Auto Manufacturers&#39;, subcategory=&#39;Auto-Cars/Light Trucks&#39;, timeZoneId=&#39;EST&#39;, tradingHours=&#39;20200301:CLOSED;20200302:0400-20200302:2000;20200303:0400-20200303:2000;20200304:0400-20200304:2000;20200305:0400-20200305:2000;20200306:0400-20200306:2000;20200307:CLOSED;20200308:CLOSED;20200309:0400-20200309:2000;20200310:0400-20200310:2000;20200311:0400-20200311:2000;20200312:0400-20200312:2000;20200313:0400-20200313:2000;20200314:CLOSED;20200315:CLOSED;20200316:0400-20200316:2000;20200317:0400-20200317:2000;20200318:0400-20200318:2000;20200319:0400-20200319:2000;20200320:0400-20200320:2000;20200321:CLOSED;20200322:CLOSED;20200323:0400-20200323:2000;20200324:0400-20200324:2000;20200325:0400-20200325:2000;20200326:0400-20200326:2000;20200327:0400-20200327:2000;20200328:CLOSED;20200329:CLOSED;20200330:0400-20200330:2000;20200331:0400-20200331:2000;20200401:0400-20200401:2000;20200402:0400-20200402:2000;20200403:0400-20200403:2000;20200404:CLOSED&#39;, liquidHours=&#39;20200301:CLOSED;20200302:0930-20200302:1600;20200303:0930-20200303:1600;20200304:0930-20200304:1600;20200305:0930-20200305:1600;20200306:0930-20200306:1600;20200307:CLOSED;20200308:CLOSED;20200309:0930-20200309:1600;20200310:0930-20200310:1600;20200311:0930-20200311:1600;20200312:0930-20200312:1600;20200313:0930-20200313:1600;20200314:CLOSED;20200315:CLOSED;20200316:0930-20200316:1600;20200317:0930-20200317:1600;20200318:0930-20200318:1600;20200319:0930-20200319:1600;20200320:0930-20200320:1600;20200321:CLOSED;20200322:CLOSED;20200323:0930-20200323:1600;20200324:0930-20200324:1600;20200325:0930-20200325:1600;20200326:0930-20200326:1600;20200327:0930-20200327:1600;20200328:CLOSED;20200329:CLOSED;20200330:0930-20200330:1600;20200331:0930-20200331:1600;20200401:0930-20200401:1600;20200402:0930-20200402:1600;20200403:0930-20200403:1600;20200404:CLOSED&#39;, evRule=&#39;&#39;, evMultiplier=0, mdSizeMultiplier=100, aggGroup=1, underSymbol=&#39;&#39;, underSecType=&#39;&#39;, marketRuleIds=&#39;26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26&#39;, secIdList=[], realExpirationDate=&#39;&#39;, lastTradeTime=&#39;&#39;, stockType=&#39;&#39;, cusip=&#39;&#39;, ratings=&#39;&#39;, descAppend=&#39;&#39;, bondType=&#39;&#39;, couponType=&#39;&#39;, callable=False, putable=False, coupon=0, convertible=False, maturity=&#39;&#39;, issueDate=&#39;&#39;, nextOptionDate=&#39;&#39;, nextOptionType=&#39;&#39;, nextOptionPartial=False, notes=&#39;&#39;)]
</code></pre><h2 id="日志信息级别"><a href="#日志信息级别" class="headerlink" title="日志信息级别"></a>日志信息级别</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">util.logToConsole()</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">util.logToConsole(logging.ERROR)</span><br></pre></td></tr></table></figure></div>
<h2 id="断开ib"><a href="#断开ib" class="headerlink" title="断开ib"></a>断开ib</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ib.disconnect()</span><br></pre></td></tr></table></figure></div>
<h1 id="合约细节"><a href="#合约细节" class="headerlink" title="合约细节"></a>合约细节</h1><h2 id="合约基础信息"><a href="#合约基础信息" class="headerlink" title="合约基础信息"></a>合约基础信息</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ib_insync <span class="keyword">import</span> *</span><br><span class="line">util.startLoop()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="comment"># util.logToConsole(logging.DEBUG)</span></span><br><span class="line"></span><br><span class="line">ib = IB()</span><br><span class="line">ib.connect(<span class="string">'127.0.0.1'</span>, <span class="number">7497</span>, clientId=<span class="number">11</span>)</span><br></pre></td></tr></table></figure></div>
<pre><code>&lt;IB connected to 127.0.0.1:7497 clientId=11&gt;
</code></pre><p>cds 包含了所有交易所对于这个合约的细节信息。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">amd = Stock(<span class="string">'AMD'</span>)</span><br><span class="line"></span><br><span class="line">cds = ib.reqContractDetails(amd)</span><br><span class="line"></span><br><span class="line">len(cds)</span><br></pre></td></tr></table></figure></div>
<pre><code>35
</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cds[<span class="number">0</span>]</span><br></pre></td></tr></table></figure></div>
<pre><code>ContractDetails(contract=Contract(secType=&#39;STK&#39;, conId=4391, symbol=&#39;AMD&#39;, exchange=&#39;SMART&#39;, primaryExchange=&#39;NASDAQ&#39;, currency=&#39;USD&#39;, localSymbol=&#39;AMD&#39;, tradingClass=&#39;NMS&#39;), marketName=&#39;NMS&#39;, minTick=0.01, orderTypes=&#39;ACTIVETIM,AD,ADJUST,ALERT,ALGO,ALLOC,AVGCOST,BASKET,BENCHPX,COND,CONDORDER,DARKONLY,DARKPOLL,DAY,DEACT,DEACTDIS,DEACTEOD,DIS,GAT,GTC,GTD,GTT,HID,IBKRATS,ICE,IMB,IOC,LIT,LMT,LOC,MIT,MKT,MOC,MTL,NGCOMB,NODARK,NONALGO,OCA,OPG,OPGREROUT,PEGBENCH,POSTONLY,PREOPGRTH,REL,RPI,RTH,SCALE,SCALEODD,SCALERST,SNAPMID,SNAPMKT,SNAPREL,STP,STPLMT,SWEEP,TRAIL,TRAILLIT,TRAILLMT,TRAILMIT,WHATIF&#39;, validExchanges=&#39;SMART,AMEX,NYSE,CBOE,PHLX,ISE,CHX,ARCA,ISLAND,DRCTEDGE,BEX,BATS,EDGEA,CSFBALGO,JEFFALGO,BYX,IEX,EDGX,FOXRIVER,NYSENAT,PSX&#39;, priceMagnifier=1, underConId=0, longName=&#39;ADVANCED MICRO DEVICES&#39;, contractMonth=&#39;&#39;, industry=&#39;Technology&#39;, category=&#39;Semiconductors&#39;, subcategory=&#39;Electronic Compo-Semicon&#39;, timeZoneId=&#39;EST&#39;, tradingHours=&#39;20200301:CLOSED;20200302:0400-20200302:2000;20200303:0400-20200303:2000;20200304:0400-20200304:2000;20200305:0400-20200305:2000;20200306:0400-20200306:2000;20200307:CLOSED;20200308:CLOSED;20200309:0400-20200309:2000;20200310:0400-20200310:2000;20200311:0400-20200311:2000;20200312:0400-20200312:2000;20200313:0400-20200313:2000;20200314:CLOSED;20200315:CLOSED;20200316:0400-20200316:2000;20200317:0400-20200317:2000;20200318:0400-20200318:2000;20200319:0400-20200319:2000;20200320:0400-20200320:2000;20200321:CLOSED;20200322:CLOSED;20200323:0400-20200323:2000;20200324:0400-20200324:2000;20200325:0400-20200325:2000;20200326:0400-20200326:2000;20200327:0400-20200327:2000;20200328:CLOSED;20200329:CLOSED;20200330:0400-20200330:2000;20200331:0400-20200331:2000;20200401:0400-20200401:2000;20200402:0400-20200402:2000;20200403:0400-20200403:2000;20200404:CLOSED&#39;, liquidHours=&#39;20200301:CLOSED;20200302:0930-20200302:1600;20200303:0930-20200303:1600;20200304:0930-20200304:1600;20200305:0930-20200305:1600;20200306:0930-20200306:1600;20200307:CLOSED;20200308:CLOSED;20200309:0930-20200309:1600;20200310:0930-20200310:1600;20200311:0930-20200311:1600;20200312:0930-20200312:1600;20200313:0930-20200313:1600;20200314:CLOSED;20200315:CLOSED;20200316:0930-20200316:1600;20200317:0930-20200317:1600;20200318:0930-20200318:1600;20200319:0930-20200319:1600;20200320:0930-20200320:1600;20200321:CLOSED;20200322:CLOSED;20200323:0930-20200323:1600;20200324:0930-20200324:1600;20200325:0930-20200325:1600;20200326:0930-20200326:1600;20200327:0930-20200327:1600;20200328:CLOSED;20200329:CLOSED;20200330:0930-20200330:1600;20200331:0930-20200331:1600;20200401:0930-20200401:1600;20200402:0930-20200402:1600;20200403:0930-20200403:1600;20200404:CLOSED&#39;, evRule=&#39;&#39;, evMultiplier=0, mdSizeMultiplier=100, aggGroup=1, underSymbol=&#39;&#39;, underSecType=&#39;&#39;, marketRuleIds=&#39;26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26&#39;, secIdList=[], realExpirationDate=&#39;&#39;, lastTradeTime=&#39;&#39;, stockType=&#39;&#39;, cusip=&#39;&#39;, ratings=&#39;&#39;, descAppend=&#39;&#39;, bondType=&#39;&#39;, couponType=&#39;&#39;, callable=False, putable=False, coupon=0, convertible=False, maturity=&#39;&#39;, issueDate=&#39;&#39;, nextOptionDate=&#39;&#39;, nextOptionType=&#39;&#39;, nextOptionPartial=False, notes=&#39;&#39;)
</code></pre><p>查看合约最基础信息</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contracts = [cd.contract <span class="keyword">for</span> cd <span class="keyword">in</span> cds]</span><br><span class="line"></span><br><span class="line">contracts[<span class="number">0</span>]</span><br></pre></td></tr></table></figure></div>
<pre><code>Contract(secType=&#39;STK&#39;, conId=4391, symbol=&#39;AMD&#39;, exchange=&#39;SMART&#39;, primaryExchange=&#39;NASDAQ&#39;, currency=&#39;USD&#39;, localSymbol=&#39;AMD&#39;, tradingClass=&#39;NMS&#39;)
</code></pre><h2 id="合约查看和filter"><a href="#合约查看和filter" class="headerlink" title="合约查看和filter"></a>合约查看和filter</h2><p>股票’AMD’的当前所以可以交易的合约信息</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">util.df(contracts).head()</span><br></pre></td></tr></table></figure></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>secType</th>
      <th>conId</th>
      <th>symbol</th>
      <th>lastTradeDateOrContractMonth</th>
      <th>strike</th>
      <th>right</th>
      <th>multiplier</th>
      <th>exchange</th>
      <th>primaryExchange</th>
      <th>currency</th>
      <th>localSymbol</th>
      <th>tradingClass</th>
      <th>includeExpired</th>
      <th>secIdType</th>
      <th>secId</th>
      <th>comboLegsDescrip</th>
      <th>comboLegs</th>
      <th>deltaNeutralContract</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>STK</td>
      <td>4391</td>
      <td>AMD</td>
      <td></td>
      <td>0.0</td>
      <td></td>
      <td></td>
      <td>SMART</td>
      <td>NASDAQ</td>
      <td>USD</td>
      <td>AMD</td>
      <td>NMS</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>STK</td>
      <td>32596680</td>
      <td>AMD</td>
      <td></td>
      <td>0.0</td>
      <td></td>
      <td></td>
      <td>SMART</td>
      <td>IBIS</td>
      <td>EUR</td>
      <td>AMD</td>
      <td>XETRA</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>STK</td>
      <td>172603743</td>
      <td>AMD</td>
      <td></td>
      <td>0.0</td>
      <td></td>
      <td></td>
      <td>SMART</td>
      <td>EBS</td>
      <td>CHF</td>
      <td>AMD</td>
      <td>AMD</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>STK</td>
      <td>298633607</td>
      <td>AMD</td>
      <td></td>
      <td>0.0</td>
      <td></td>
      <td></td>
      <td>SMART</td>
      <td>ASX</td>
      <td>AUD</td>
      <td>AMD</td>
      <td>AMD</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>STK</td>
      <td>4391</td>
      <td>AMD</td>
      <td></td>
      <td>0.0</td>
      <td></td>
      <td></td>
      <td>AMEX</td>
      <td>NASDAQ</td>
      <td>USD</td>
      <td>AMD</td>
      <td>NMS</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>



<p>查询期货gc的当前所有合约</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gc = ib.reqContractDetails(Future(<span class="string">'GC'</span>))</span><br><span class="line">gc_contracts_df = util.df([cd.contract <span class="keyword">for</span> cd <span class="keyword">in</span> gc])</span><br><span class="line">gc_contracts_df.head(<span class="number">5</span>)</span><br></pre></td></tr></table></figure></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>secType</th>
      <th>conId</th>
      <th>symbol</th>
      <th>lastTradeDateOrContractMonth</th>
      <th>strike</th>
      <th>right</th>
      <th>multiplier</th>
      <th>exchange</th>
      <th>primaryExchange</th>
      <th>currency</th>
      <th>localSymbol</th>
      <th>tradingClass</th>
      <th>includeExpired</th>
      <th>secIdType</th>
      <th>secId</th>
      <th>comboLegsDescrip</th>
      <th>comboLegs</th>
      <th>deltaNeutralContract</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>FUT</td>
      <td>158708412</td>
      <td>GC</td>
      <td>20200626</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCM0</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>FUT</td>
      <td>178747429</td>
      <td>GC</td>
      <td>20201229</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCZ0</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>FUT</td>
      <td>198577650</td>
      <td>GC</td>
      <td>20210628</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCM1</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>FUT</td>
      <td>217648791</td>
      <td>GC</td>
      <td>20211229</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCZ1</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FUT</td>
      <td>238666255</td>
      <td>GC</td>
      <td>20220628</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCM2</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>



<p>当前所有NYMEX的GC的期货合约</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gc_contracts_df[gc_contracts_df[<span class="string">"exchange"</span>] == <span class="string">"NYMEX"</span>].sort_values(<span class="string">"lastTradeDateOrContractMonth"</span>)</span><br></pre></td></tr></table></figure></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>secType</th>
      <th>conId</th>
      <th>symbol</th>
      <th>lastTradeDateOrContractMonth</th>
      <th>strike</th>
      <th>right</th>
      <th>multiplier</th>
      <th>exchange</th>
      <th>primaryExchange</th>
      <th>currency</th>
      <th>localSymbol</th>
      <th>tradingClass</th>
      <th>includeExpired</th>
      <th>secIdType</th>
      <th>secId</th>
      <th>comboLegsDescrip</th>
      <th>comboLegs</th>
      <th>deltaNeutralContract</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18</th>
      <td>FUT</td>
      <td>397594943</td>
      <td>GC</td>
      <td>20200327</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCH0</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>8</th>
      <td>FUT</td>
      <td>319684499</td>
      <td>GC</td>
      <td>20200428</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCJ0</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>20</th>
      <td>FUT</td>
      <td>405978966</td>
      <td>GC</td>
      <td>20200527</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCK0</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>0</th>
      <td>FUT</td>
      <td>158708412</td>
      <td>GC</td>
      <td>20200626</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCM0</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>10</th>
      <td>FUT</td>
      <td>335154396</td>
      <td>GC</td>
      <td>20200827</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCQ0</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>11</th>
      <td>FUT</td>
      <td>343699127</td>
      <td>GC</td>
      <td>20201028</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCV0</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>FUT</td>
      <td>178747429</td>
      <td>GC</td>
      <td>20201229</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCZ0</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>13</th>
      <td>FUT</td>
      <td>358917044</td>
      <td>GC</td>
      <td>20210224</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCG1</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>14</th>
      <td>FUT</td>
      <td>368776104</td>
      <td>GC</td>
      <td>20210428</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCJ1</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>FUT</td>
      <td>198577650</td>
      <td>GC</td>
      <td>20210628</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCM1</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>16</th>
      <td>FUT</td>
      <td>385426871</td>
      <td>GC</td>
      <td>20210827</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCQ1</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>17</th>
      <td>FUT</td>
      <td>393223512</td>
      <td>GC</td>
      <td>20211027</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCV1</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>FUT</td>
      <td>217648791</td>
      <td>GC</td>
      <td>20211229</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCZ1</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FUT</td>
      <td>238666255</td>
      <td>GC</td>
      <td>20220628</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCM2</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>FUT</td>
      <td>260862601</td>
      <td>GC</td>
      <td>20221228</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCZ2</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>FUT</td>
      <td>280949060</td>
      <td>GC</td>
      <td>20230628</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCM3</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7</th>
      <td>FUT</td>
      <td>301051213</td>
      <td>GC</td>
      <td>20231227</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCZ3</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>9</th>
      <td>FUT</td>
      <td>324078607</td>
      <td>GC</td>
      <td>20240626</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCM4</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>12</th>
      <td>FUT</td>
      <td>347896248</td>
      <td>GC</td>
      <td>20241227</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCZ4</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>15</th>
      <td>FUT</td>
      <td>372852975</td>
      <td>GC</td>
      <td>20250626</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCM5</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
    <tr>
      <th>19</th>
      <td>FUT</td>
      <td>397594951</td>
      <td>GC</td>
      <td>20251229</td>
      <td>0.0</td>
      <td></td>
      <td>100</td>
      <td>NYMEX</td>
      <td></td>
      <td>USD</td>
      <td>GCZ5</td>
      <td>GC</td>
      <td>False</td>
      <td></td>
      <td></td>
      <td></td>
      <td>[]</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>



<p>SMART交易所的唯一AMD合约</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">amd = Stock(<span class="string">'AMD'</span>, <span class="string">'SMART'</span>, <span class="string">'USD'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> len(ib.reqContractDetails(amd)) == <span class="number">1</span></span><br></pre></td></tr></table></figure></div>
<p>SMART交易所的唯一INTC合约</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">intc = Stock(<span class="string">'INTC'</span>, <span class="string">'SMART'</span>, <span class="string">'USD'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> len(ib.reqContractDetails(intc)) == <span class="number">1</span></span><br></pre></td></tr></table></figure></div>
<p>不存在的合约</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx = Stock(<span class="string">'XXX'</span>, <span class="string">'SMART'</span>, <span class="string">'USD'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> len(ib.reqContractDetails(xxx)) == <span class="number">0</span></span><br></pre></td></tr></table></figure></div>
<pre><code>2020-03-01 18:01:03,946 ib_insync.wrapper ERROR Error 200, reqId 7: No security definition has been found for the request, contract: Stock(symbol=&#39;XXX&#39;, exchange=&#39;SMART&#39;, currency=&#39;USD&#39;)
</code></pre><p>EURUSD forex合约</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eurusd = Forex(<span class="string">'EURUSD'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> len(ib.reqContractDetails(eurusd)) == <span class="number">1</span></span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">amd</span><br></pre></td></tr></table></figure></div>
<pre><code>Stock(symbol=&#39;AMD&#39;, exchange=&#39;SMART&#39;, currency=&#39;USD&#39;)
</code></pre><p>填充contrat missing的信息</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ib.qualifyContracts(amd)</span><br><span class="line">amd</span><br></pre></td></tr></table></figure></div>
<pre><code>Stock(conId=4391, symbol=&#39;AMD&#39;, exchange=&#39;SMART&#39;, primaryExchange=&#39;NASDAQ&#39;, currency=&#39;USD&#39;, localSymbol=&#39;AMD&#39;, tradingClass=&#39;NMS&#39;)
</code></pre><p>填充一个contracts的list</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">qualContracts = ib.qualifyContracts(amd, intc, xxx, eurusd)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> intc <span class="keyword">in</span> qualContracts</span><br><span class="line"><span class="keyword">assert</span> xxx <span class="keyword">not</span> <span class="keyword">in</span> qualContracts</span><br></pre></td></tr></table></figure></div>
<pre><code>2020-03-01 18:54:48,242 ib_insync.wrapper ERROR Error 200, reqId 13: No security definition has been found for the request, contract: Stock(symbol=&#39;XXX&#39;, exchange=&#39;SMART&#39;, currency=&#39;USD&#39;)
2020-03-01 18:54:48,244 ib_insync.ib ERROR Unknown contract: Stock(symbol=&#39;XXX&#39;, exchange=&#39;SMART&#39;, currency=&#39;USD&#39;)
</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qualContracts</span><br></pre></td></tr></table></figure></div>
<pre><code>[Stock(conId=4391, symbol=&#39;AMD&#39;, exchange=&#39;SMART&#39;, primaryExchange=&#39;NASDAQ&#39;, currency=&#39;USD&#39;, localSymbol=&#39;AMD&#39;, tradingClass=&#39;NMS&#39;),
 Stock(conId=270639, symbol=&#39;INTC&#39;, exchange=&#39;SMART&#39;, primaryExchange=&#39;NASDAQ&#39;, currency=&#39;USD&#39;, localSymbol=&#39;INTC&#39;, tradingClass=&#39;NMS&#39;),
 Forex(&#39;EURUSD&#39;, conId=12087792, exchange=&#39;IDEALPRO&#39;, localSymbol=&#39;EUR.USD&#39;, tradingClass=&#39;EUR.USD&#39;)]
</code></pre><p>股票专用查询合约。查询包含intc的所有合约</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">matches = ib.reqMatchingSymbols(<span class="string">'intc'</span>)</span><br><span class="line">matchContracts = [m.contract <span class="keyword">for</span> m <span class="keyword">in</span> matches]</span><br><span class="line"></span><br><span class="line">matches</span><br></pre></td></tr></table></figure></div>
<pre><code>[ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=270639, symbol=&#39;INTC&#39;, primaryExchange=&#39;NASDAQ.NMS&#39;, currency=&#39;USD&#39;), derivativeSecTypes=[&#39;CFD&#39;, &#39;OPT&#39;, &#39;IOPT&#39;, &#39;WAR&#39;, &#39;FUT&#39;, &#39;BAG&#39;]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=38709539, symbol=&#39;INTC&#39;, primaryExchange=&#39;MEXI&#39;, currency=&#39;MXN&#39;), derivativeSecTypes=[]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=12178234, symbol=&#39;INTC&#39;, primaryExchange=&#39;EBS&#39;, currency=&#39;CHF&#39;), derivativeSecTypes=[]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=11463493, symbol=&#39;INTCUSD&#39;, primaryExchange=&#39;EBS&#39;, currency=&#39;USD&#39;), derivativeSecTypes=[]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=130861844, symbol=&#39;S&#39;, primaryExchange=&#39;MEXI&#39;, currency=&#39;MXN&#39;), derivativeSecTypes=[]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=130861851, symbol=&#39;2S7&#39;, primaryExchange=&#39;FWB&#39;, currency=&#39;EUR&#39;), derivativeSecTypes=[]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=130651996, symbol=&#39;S&#39;, primaryExchange=&#39;NYSE&#39;, currency=&#39;USD&#39;), derivativeSecTypes=[&#39;CFD&#39;, &#39;OPT&#39;, &#39;FUT&#39;, &#39;BAG&#39;]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=14015710, symbol=&#39;4613&#39;, primaryExchange=&#39;TSEJ&#39;, currency=&#39;JPY&#39;), derivativeSecTypes=[&#39;CFD&#39;]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=257310905, symbol=&#39;002436&#39;, primaryExchange=&#39;SEHKSZSE&#39;, currency=&#39;CNH&#39;), derivativeSecTypes=[]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=257765562, symbol=&#39;603737&#39;, primaryExchange=&#39;SEHKNTL&#39;, currency=&#39;CNH&#39;), derivativeSecTypes=[]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=234809384, symbol=&#39;FPQ1&#39;, primaryExchange=&#39;FWB2&#39;, currency=&#39;EUR&#39;), derivativeSecTypes=[&#39;IOPT&#39;]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=234809383, symbol=&#39;FING.B&#39;, primaryExchange=&#39;SFB&#39;, currency=&#39;SEK&#39;), derivativeSecTypes=[&#39;CFD&#39;, &#39;OPT&#39;, &#39;IOPT&#39;, &#39;BAG&#39;]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=83364054, symbol=&#39;FRP&#39;, primaryExchange=&#39;VALUE&#39;, currency=&#39;USD&#39;), derivativeSecTypes=[]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=169544707, symbol=&#39;ECC&#39;, primaryExchange=&#39;NYSE&#39;, currency=&#39;USD&#39;), derivativeSecTypes=[]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=90691307, symbol=&#39;1151&#39;, primaryExchange=&#39;SEHK&#39;, currency=&#39;HKD&#39;), derivativeSecTypes=[]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=96816938, symbol=&#39;E16&#39;, primaryExchange=&#39;SGX&#39;, currency=&#39;USD&#39;), derivativeSecTypes=[]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=392988575, symbol=&#39;1JO&#39;, primaryExchange=&#39;FWB2&#39;, currency=&#39;EUR&#39;), derivativeSecTypes=[]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=173148149, symbol=&#39;JYNT&#39;, primaryExchange=&#39;NASDAQ.SCM&#39;, currency=&#39;USD&#39;), derivativeSecTypes=[&#39;OPT&#39;, &#39;BAG&#39;]),
 ContractDescription(contract=Contract(secType=&#39;STK&#39;, conId=131085231, symbol=&#39;4621&#39;, primaryExchange=&#39;TSEJ&#39;, currency=&#39;JPY&#39;), derivativeSecTypes=[])]
</code></pre><h1 id="期权链"><a href="#期权链" class="headerlink" title="期权链"></a>期权链</h1><p>spx合约</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spx = Index(<span class="string">'SPX'</span>, <span class="string">'CBOE'</span>)</span><br><span class="line">ib.qualifyContracts(spx)</span><br></pre></td></tr></table></figure></div>
<pre><code>[Index(conId=416904, symbol=&#39;SPX&#39;, exchange=&#39;CBOE&#39;, currency=&#39;USD&#39;, localSymbol=&#39;SPX&#39;)]
</code></pre><p>这里使用delayed data.</p>
<p>marketDataType: One of:</p>
<pre><code>* 1 = Live
* 2 = Frozen
* 3 = Delayed
* 4 = Delayed frozen
</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ib.reqMarketDataType(<span class="number">4</span>)</span><br></pre></td></tr></table></figure></div>
<p>当前tick信息</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ticker] = ib.reqTickers(spx)</span><br><span class="line">ticker</span><br></pre></td></tr></table></figure></div>
<pre><code>Ticker(contract=Index(conId=416904, symbol=&#39;SPX&#39;, exchange=&#39;CBOE&#39;, currency=&#39;USD&#39;, localSymbol=&#39;SPX&#39;), time=datetime.datetime(2020, 3, 2, 0, 1, 57, 930587, tzinfo=datetime.timezone.utc), bid=-1.0, bidSize=0, ask=-1.0, askSize=0, last=-1.0, lastSize=0)
</code></pre><p>当前市场价格。因为是非交易时间所以是nan</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spxValue = ticker.marketPrice()</span><br><span class="line">spxValue</span><br></pre></td></tr></table></figure></div>
<pre><code>nan
</code></pre><p>查看option链</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chains = ib.reqSecDefOptParams(spx.symbol, <span class="string">''</span>, spx.secType, spx.conId)</span><br><span class="line"></span><br><span class="line">util.df(chains)</span><br></pre></td></tr></table></figure></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>exchange</th>
      <th>underlyingConId</th>
      <th>tradingClass</th>
      <th>multiplier</th>
      <th>expirations</th>
      <th>strikes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SMART</td>
      <td>416904</td>
      <td>SPX</td>
      <td>100</td>
      <td>[20200319, 20200416, 20200514, 20200618, 20200...</td>
      <td>[100.0, 200.0, 300.0, 400.0, 500.0, 600.0, 650...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CBOE</td>
      <td>416904</td>
      <td>SPXW</td>
      <td>100</td>
      <td>[20200302, 20200304, 20200306, 20200309, 20200...</td>
      <td>[800.0, 900.0, 1000.0, 1100.0, 1150.0, 1200.0,...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SMART</td>
      <td>416904</td>
      <td>SPXW</td>
      <td>100</td>
      <td>[20200302, 20200304, 20200306, 20200309, 20200...</td>
      <td>[800.0, 900.0, 1000.0, 1100.0, 1150.0, 1200.0,...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CBOE</td>
      <td>416904</td>
      <td>SPX</td>
      <td>100</td>
      <td>[20200319, 20200416, 20200514, 20200618, 20200...</td>
      <td>[100.0, 200.0, 300.0, 400.0, 500.0, 600.0, 650...</td>
    </tr>
  </tbody>
</table>
</div>



<p>选择tradingclass 是spx, exchange是smart的那个合约， 查看这个合约的option chain</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chain = next(c <span class="keyword">for</span> c <span class="keyword">in</span> chains <span class="keyword">if</span> c.tradingClass == <span class="string">'SPX'</span> <span class="keyword">and</span> c.exchange == <span class="string">'SMART'</span>)</span><br><span class="line">chain</span><br></pre></td></tr></table></figure></div>
<pre><code>OptionChain(exchange=&#39;SMART&#39;, underlyingConId=&#39;416904&#39;, tradingClass=&#39;SPX&#39;, multiplier=&#39;100&#39;, expirations=[&#39;20200319&#39;, &#39;20200416&#39;, &#39;20200514&#39;, &#39;20200618&#39;, &#39;20200716&#39;, &#39;20200820&#39;, &#39;20200917&#39;, &#39;20201015&#39;, &#39;20201119&#39;, &#39;20201217&#39;, &#39;20210114&#39;, &#39;20210318&#39;, &#39;20210617&#39;, &#39;20211216&#39;, &#39;20221215&#39;], strikes=[100.0, 200.0, 300.0, 400.0, 500.0, 600.0, 650.0, 700.0, 750.0, 800.0, 850.0, 900.0, 950.0, 1000.0, 1050.0, 1100.0, 1150.0, 1200.0, 1225.0, 1250.0, 1275.0, 1300.0, 1325.0, 1350.0, 1375.0, 1400.0, 1425.0, 1450.0, 1475.0, 1500.0, 1525.0, 1550.0, 1575.0, 1600.0, 1625.0, 1650.0, 1675.0, 1700.0, 1725.0, 1750.0, 1775.0, 1800.0, 1825.0, 1850.0, 1875.0, 1900.0, 1925.0, 1950.0, 1975.0, 2000.0, 2025.0, 2050.0, 2075.0, 2090.0, 2100.0, 2110.0, 2120.0, 2125.0, 2130.0, 2140.0, 2150.0, 2160.0, 2170.0, 2175.0, 2180.0, 2190.0, 2200.0, 2210.0, 2220.0, 2225.0, 2230.0, 2240.0, 2250.0, 2260.0, 2270.0, 2275.0, 2280.0, 2290.0, 2300.0, 2310.0, 2320.0, 2325.0, 2330.0, 2340.0, 2350.0, 2360.0, 2370.0, 2375.0, 2380.0, 2385.0, 2390.0, 2395.0, 2400.0, 2405.0, 2410.0, 2415.0, 2420.0, 2425.0, 2430.0, 2435.0, 2440.0, 2445.0, 2450.0, 2455.0, 2460.0, 2465.0, 2470.0, 2475.0, 2480.0, 2485.0, 2490.0, 2495.0, 2500.0, 2505.0, 2510.0, 2515.0, 2520.0, 2525.0, 2530.0, 2535.0, 2540.0, 2545.0, 2550.0, 2555.0, 2560.0, 2565.0, 2570.0, 2575.0, 2580.0, 2585.0, 2590.0, 2595.0, 2600.0, 2605.0, 2610.0, 2615.0, 2620.0, 2625.0, 2630.0, 2635.0, 2640.0, 2645.0, 2650.0, 2655.0, 2660.0, 2665.0, 2670.0, 2675.0, 2680.0, 2685.0, 2690.0, 2695.0, 2700.0, 2705.0, 2710.0, 2715.0, 2720.0, 2725.0, 2730.0, 2735.0, 2740.0, 2745.0, 2750.0, 2755.0, 2760.0, 2765.0, 2770.0, 2775.0, 2780.0, 2785.0, 2790.0, 2795.0, 2800.0, 2805.0, 2810.0, 2815.0, 2820.0, 2825.0, 2830.0, 2835.0, 2840.0, 2845.0, 2850.0, 2855.0, 2860.0, 2865.0, 2870.0, 2875.0, 2880.0, 2885.0, 2890.0, 2895.0, 2900.0, 2905.0, 2910.0, 2915.0, 2920.0, 2925.0, 2930.0, 2935.0, 2940.0, 2945.0, 2950.0, 2955.0, 2960.0, 2965.0, 2970.0, 2975.0, 2980.0, 2985.0, 2990.0, 2995.0, 3000.0, 3005.0, 3010.0, 3015.0, 3020.0, 3025.0, 3030.0, 3035.0, 3040.0, 3045.0, 3050.0, 3055.0, 3060.0, 3065.0, 3070.0, 3075.0, 3080.0, 3085.0, 3090.0, 3095.0, 3100.0, 3105.0, 3110.0, 3115.0, 3120.0, 3125.0, 3130.0, 3135.0, 3140.0, 3145.0, 3150.0, 3155.0, 3160.0, 3165.0, 3170.0, 3175.0, 3180.0, 3185.0, 3190.0, 3195.0, 3200.0, 3205.0, 3210.0, 3215.0, 3220.0, 3225.0, 3230.0, 3235.0, 3240.0, 3245.0, 3250.0, 3255.0, 3260.0, 3265.0, 3270.0, 3275.0, 3280.0, 3285.0, 3290.0, 3295.0, 3300.0, 3305.0, 3310.0, 3315.0, 3320.0, 3325.0, 3330.0, 3335.0, 3340.0, 3345.0, 3350.0, 3355.0, 3360.0, 3365.0, 3370.0, 3375.0, 3380.0, 3385.0, 3390.0, 3395.0, 3400.0, 3405.0, 3410.0, 3415.0, 3420.0, 3425.0, 3430.0, 3435.0, 3440.0, 3445.0, 3450.0, 3455.0, 3460.0, 3465.0, 3470.0, 3475.0, 3480.0, 3485.0, 3490.0, 3495.0, 3500.0, 3505.0, 3510.0, 3515.0, 3520.0, 3525.0, 3530.0, 3535.0, 3540.0, 3545.0, 3550.0, 3555.0, 3560.0, 3565.0, 3570.0, 3575.0, 3580.0, 3585.0, 3590.0, 3595.0, 3600.0, 3605.0, 3610.0, 3615.0, 3620.0, 3625.0, 3630.0, 3635.0, 3640.0, 3650.0, 3660.0, 3670.0, 3675.0, 3680.0, 3690.0, 3700.0, 3710.0, 3720.0, 3725.0, 3750.0, 3775.0, 3800.0, 3850.0, 3900.0, 3950.0, 4000.0, 4050.0, 4100.0, 4200.0, 4300.0, 4400.0, 4500.0, 4600.0, 4700.0, 4800.0, 4900.0])
</code></pre><h1 id="Bar数据"><a href="#Bar数据" class="headerlink" title="Bar数据"></a>Bar数据</h1><p>GC future合约 2020年4月28日到期</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">contract_319684499 = Contract(conId=<span class="number">319684499</span>)</span><br><span class="line">ib.qualifyContracts(contract_319684499)</span><br></pre></td></tr></table></figure></div>
<pre><code>[Contract(secType=&#39;FUT&#39;, conId=319684499, symbol=&#39;GC&#39;, lastTradeDateOrContractMonth=&#39;20200428&#39;, multiplier=&#39;100&#39;, exchange=&#39;NYMEX&#39;, currency=&#39;USD&#39;, localSymbol=&#39;GCJ0&#39;, tradingClass=&#39;GC&#39;)]
</code></pre><p>合约开始时间</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ib.reqHeadTimeStamp(contract_319684499, whatToShow=<span class="string">'MIDPOINT'</span>, useRTH=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></div>
<pre><code>datetime.datetime(2018, 5, 30, 22, 0)
</code></pre><p>10天的1分钟数据。一次下太多ib就要搞你，10天的够了。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bars = ib.reqHistoricalData(</span><br><span class="line">        contract_319684499,</span><br><span class="line">        endDateTime=<span class="string">''</span>,</span><br><span class="line">        durationStr=<span class="string">'10 D'</span>,</span><br><span class="line">        barSizeSetting=<span class="string">'1 min'</span>,</span><br><span class="line">        whatToShow=<span class="string">'TRADES'</span>,</span><br><span class="line">        useRTH=<span class="literal">True</span>,</span><br><span class="line">        formatDate=<span class="number">1</span>)</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bars[<span class="number">0</span>]</span><br></pre></td></tr></table></figure></div>
<pre><code>BarData(date=datetime.datetime(2020, 2, 14, 9, 30), open=1583.3, high=1583.8, low=1583.0, close=1583.4, volume=922, average=1583.43, barCount=347)
</code></pre><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = util.df(bars)</span><br><span class="line">display(df.head())</span><br><span class="line">display(df.tail())</span><br></pre></td></tr></table></figure></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
      <th>volume</th>
      <th>average</th>
      <th>barCount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-02-14 09:30:00</td>
      <td>1583.3</td>
      <td>1583.8</td>
      <td>1583.0</td>
      <td>1583.4</td>
      <td>922</td>
      <td>1583.43</td>
      <td>347</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-02-14 09:31:00</td>
      <td>1583.5</td>
      <td>1583.6</td>
      <td>1583.2</td>
      <td>1583.4</td>
      <td>547</td>
      <td>1583.45</td>
      <td>240</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-02-14 09:32:00</td>
      <td>1583.4</td>
      <td>1583.4</td>
      <td>1582.6</td>
      <td>1582.7</td>
      <td>786</td>
      <td>1582.95</td>
      <td>299</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-02-14 09:33:00</td>
      <td>1582.8</td>
      <td>1582.9</td>
      <td>1582.1</td>
      <td>1582.6</td>
      <td>710</td>
      <td>1582.43</td>
      <td>293</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-02-14 09:34:00</td>
      <td>1582.7</td>
      <td>1582.8</td>
      <td>1582.4</td>
      <td>1582.6</td>
      <td>230</td>
      <td>1582.58</td>
      <td>127</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
      <th>volume</th>
      <th>average</th>
      <th>barCount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4495</th>
      <td>2020-02-28 16:55:00</td>
      <td>1586.6</td>
      <td>1589.0</td>
      <td>1586.2</td>
      <td>1586.8</td>
      <td>82</td>
      <td>1587.33</td>
      <td>50</td>
    </tr>
    <tr>
      <th>4496</th>
      <td>2020-02-28 16:56:00</td>
      <td>1586.9</td>
      <td>1588.6</td>
      <td>1586.2</td>
      <td>1587.0</td>
      <td>42</td>
      <td>1587.39</td>
      <td>32</td>
    </tr>
    <tr>
      <th>4497</th>
      <td>2020-02-28 16:57:00</td>
      <td>1587.0</td>
      <td>1588.7</td>
      <td>1587.0</td>
      <td>1587.4</td>
      <td>104</td>
      <td>1587.74</td>
      <td>40</td>
    </tr>
    <tr>
      <th>4498</th>
      <td>2020-02-28 16:58:00</td>
      <td>1587.7</td>
      <td>1588.1</td>
      <td>1587.4</td>
      <td>1587.7</td>
      <td>29</td>
      <td>1587.71</td>
      <td>20</td>
    </tr>
    <tr>
      <th>4499</th>
      <td>2020-02-28 16:59:00</td>
      <td>1587.3</td>
      <td>1587.5</td>
      <td>1586.5</td>
      <td>1587.3</td>
      <td>43</td>
      <td>1587.00</td>
      <td>26</td>
    </tr>
  </tbody>
</table>
</div>


<p>下面的code通过循环把一个合约所有数据都下载下来</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">contract_319684499 = Contract(conId=<span class="number">319684499</span>)</span><br><span class="line">ib.qualifyContracts(contract_319684499)</span><br><span class="line"></span><br><span class="line">dt = <span class="string">''</span></span><br><span class="line">barsList = []</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    bars = ib.reqHistoricalData(</span><br><span class="line">        contract_319684499,</span><br><span class="line">        endDateTime=dt,</span><br><span class="line">        durationStr=<span class="string">'10 D'</span>,</span><br><span class="line">        barSizeSetting=<span class="string">'1 min'</span>,</span><br><span class="line">        whatToShow=<span class="string">'TRADES'</span>,</span><br><span class="line">        useRTH=<span class="literal">True</span>,</span><br><span class="line">        formatDate=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bars:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    barsList.append(bars)</span><br><span class="line">    dt = bars[<span class="number">0</span>].date</span><br><span class="line">    print(dt)</span><br><span class="line"></span><br><span class="line">allBars = [b <span class="keyword">for</span> bars <span class="keyword">in</span> reversed(barsList) <span class="keyword">for</span> b <span class="keyword">in</span> bars]</span><br><span class="line">df = util.df(allBars)</span><br></pre></td></tr></table></figure></div>
<pre><code>2020-02-14 09:30:00
2020-01-31 09:30:00
2020-01-16 09:30:00
2020-01-02 09:30:00
2019-12-17 09:30:00
2019-12-03 09:30:00
2019-11-18 09:30:00
2019-11-04 09:30:00
2019-10-21 09:30:00
2019-10-07 09:30:00
2019-09-23 09:30:00
2019-09-09 09:30:00
2019-08-23 09:30:00
2019-08-09 09:30:00
2019-07-26 09:30:00
2019-07-12 09:30:00
2019-06-27 09:30:00
2019-06-13 09:30:00
2019-05-30 09:30:00
2019-05-15 09:30:00
2019-05-01 10:21:00
2019-04-17 09:30:00
2019-04-03 10:53:00
2019-03-21 09:30:00
2019-03-07 09:30:00
2019-02-21 09:30:00
2019-02-06 09:45:00
2019-01-24 09:55:00
2019-01-11 09:30:00
2019-01-02 09:30:00
2018-12-20 14:43:00
2018-12-07 10:01:00
2018-11-29 09:42:00
2018-11-23 11:44:00


Error 162, reqId 39: Historical Market Data Service error message:HMDS query returned no data: GCJ0@NYMEX Trades, contract: Contract(secType=&#39;FUT&#39;, conId=319684499, symbol=&#39;GC&#39;, lastTradeDateOrContractMonth=&#39;20200428&#39;, multiplier=&#39;100&#39;, exchange=&#39;NYMEX&#39;, currency=&#39;USD&#39;, localSymbol=&#39;GCJ0&#39;, tradingClass=&#39;GC&#39;)
</code></pre><p>上面的报错原因猜测是因为20181123之前，成交量太低了,选择whattoshow == “TRADE”的话就返回不了数据. 选择whattoshow == “MIDPOINT” 还是可以返回数据， 但是我们不需要了,到这就够了.</p>
<p>下面的数可以看出，20181123的时候这个合约还不是主力合约，没有人交易。而当前最新的交易量显示它是主力合约</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.head()</span><br></pre></td></tr></table></figure></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
      <th>volume</th>
      <th>average</th>
      <th>barCount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-11-23 11:44:00</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>11</td>
      <td>1272.7</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-11-23 11:45:00</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>0</td>
      <td>1272.7</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-11-23 11:46:00</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>0</td>
      <td>1272.7</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018-11-23 11:47:00</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>0</td>
      <td>1272.7</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018-11-23 11:48:00</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>1272.7</td>
      <td>0</td>
      <td>1272.7</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.tail()</span><br></pre></td></tr></table></figure></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
      <th>volume</th>
      <th>average</th>
      <th>barCount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>119254</th>
      <td>2020-02-28 16:55:00</td>
      <td>1586.6</td>
      <td>1589.0</td>
      <td>1586.2</td>
      <td>1586.8</td>
      <td>82</td>
      <td>1587.33</td>
      <td>50</td>
    </tr>
    <tr>
      <th>119255</th>
      <td>2020-02-28 16:56:00</td>
      <td>1586.9</td>
      <td>1588.6</td>
      <td>1586.2</td>
      <td>1587.0</td>
      <td>42</td>
      <td>1587.39</td>
      <td>32</td>
    </tr>
    <tr>
      <th>119256</th>
      <td>2020-02-28 16:57:00</td>
      <td>1587.0</td>
      <td>1588.7</td>
      <td>1587.0</td>
      <td>1587.4</td>
      <td>104</td>
      <td>1587.74</td>
      <td>40</td>
    </tr>
    <tr>
      <th>119257</th>
      <td>2020-02-28 16:58:00</td>
      <td>1587.7</td>
      <td>1588.1</td>
      <td>1587.4</td>
      <td>1587.7</td>
      <td>29</td>
      <td>1587.71</td>
      <td>20</td>
    </tr>
    <tr>
      <th>119258</th>
      <td>2020-02-28 16:59:00</td>
      <td>1587.3</td>
      <td>1587.5</td>
      <td>1586.5</td>
      <td>1587.3</td>
      <td>43</td>
      <td>1587.00</td>
      <td>26</td>
    </tr>
  </tbody>
</table>
</div>




<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.describe()</span><br></pre></td></tr></table></figure></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
      <th>volume</th>
      <th>average</th>
      <th>barCount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>119259.000000</td>
      <td>119259.000000</td>
      <td>119259.000000</td>
      <td>119259.000000</td>
      <td>119259.000000</td>
      <td>119259.000000</td>
      <td>119259.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1452.039395</td>
      <td>1452.075496</td>
      <td>1452.000574</td>
      <td>1452.037914</td>
      <td>31.230398</td>
      <td>1452.038183</td>
      <td>13.755918</td>
    </tr>
    <tr>
      <th>std</th>
      <td>95.843262</td>
      <td>95.894540</td>
      <td>95.788182</td>
      <td>95.841548</td>
      <td>167.720980</td>
      <td>95.841501</td>
      <td>71.451877</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1272.700000</td>
      <td>1272.700000</td>
      <td>1272.700000</td>
      <td>1272.700000</td>
      <td>0.000000</td>
      <td>1272.700000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1352.000000</td>
      <td>1352.000000</td>
      <td>1352.000000</td>
      <td>1352.000000</td>
      <td>0.000000</td>
      <td>1352.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1475.600000</td>
      <td>1475.600000</td>
      <td>1475.600000</td>
      <td>1475.600000</td>
      <td>0.000000</td>
      <td>1475.600000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1524.600000</td>
      <td>1524.600000</td>
      <td>1524.600000</td>
      <td>1524.600000</td>
      <td>0.000000</td>
      <td>1524.600000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1684.800000</td>
      <td>1686.600000</td>
      <td>1683.800000</td>
      <td>1684.300000</td>
      <td>9591.000000</td>
      <td>1685.380000</td>
      <td>3716.000000</td>
    </tr>
  </tbody>
</table>
</div>




<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.to_csv(contract_319684499.symbol + <span class="string">'.csv'</span>)</span><br></pre></td></tr></table></figure></div>
</div></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/finance/">finance    </a><a class="post-meta__tags" href="/tags/IB/">IB    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200210210529.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2020/02/16/python/advanced/class_instances_to_dataframe/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200201165020.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>class_instances_to_dataframe</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/02/07/random_notes/option_trade_small_summary/" title="option trade small summary.md"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200207205039.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-07</div><div class="relatedPosts_title">option trade small summary.md</div></div></a></div><div class="relatedPosts_item"><a href="/2018/12/30/finance/cfa_level1/2_1_Time_Value_Of_Money/" title="CFA note chapter 2 - 数量分析"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-12-30</div><div class="relatedPosts_title">CFA note chapter 2 - 数量分析</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/10/finance/vnpy_notes/cta_summary/" title="CTA summary notes"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200210210529.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-10</div><div class="relatedPosts_title">CTA summary notes</div></div></a></div><div class="relatedPosts_item"><a href="/2018/12/10/finance/basics/stock/stock_introduction/" title="stock introduction"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-12-10</div><div class="relatedPosts_title">stock introduction</div></div></a></div><div class="relatedPosts_item"><a href="/2019/12/12/finance/basics/option/期权36课笔记/" title="期权36课笔记"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-12-12</div><div class="relatedPosts_title">期权36课笔记</div></div></a></div><div class="relatedPosts_item"><a href="/2019/12/25/finance/basics/future/期货从业资格/" title="期货从业资格笔记"><img class="relatedPosts_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200202103940.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-12-25</div><div class="relatedPosts_title">期货从业资格笔记</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = true == true ? true : false;
var verify = true == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'xvMxbws16Erd8WUfqxkvHmb5-gzGzoHsz',
  appKey:'4U0Vo7NQIUL0eJzHdkPzdCDr',
  placeholder:'不说话的人会疯掉吗?',
  avatar:'retro',
  guest_info:guest_info,
  pageSize:'10',
  lang:'en',
  recordIP: true
});</script></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/supersheepbear/blog_source@master/blog/image/20200210210529.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2020 By supersheepbear</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="external nofollow noopener noreferrer"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="external nofollow noopener noreferrer"><span>Butterfly</span></a></div><div class="footer_custom_text">外向孤独者患者</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script id="canvas_nest" color="255,240,245" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-nest.js"></script><script src="https://cdn.jsdelivr.net/npm/activate-power-mode/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false; 
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="external nofollow noopener noreferrer" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body></html>